<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>åˆ˜æ–°å†¬çš„åšå®¢</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/blog/img/logo.png">
    <meta name="description" content="åˆ˜æ–°å†¬çš„æŠ€æœ¯åšå®¢ï¼Œè®°å½•å­¦ä¹ ç¬”è®°ä»¥åŠå¼€å‘ä¸­é‡åˆ°çš„å„ç§æŠ€æœ¯é—®é¢˜">
    
    <link rel="preload" href="/blog/assets/css/0.styles.495eacbe.css" as="style"><link rel="preload" href="/blog/assets/js/app.ba74f136.js" as="script"><link rel="preload" href="/blog/assets/js/2.ba6b1436.js" as="script"><link rel="preload" href="/blog/assets/js/1.2d4ce02f.js" as="script"><link rel="preload" href="/blog/assets/js/102.cbf39534.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.14082ad8.js"><link rel="prefetch" href="/blog/assets/js/100.dcafd219.js"><link rel="prefetch" href="/blog/assets/js/101.74760706.js"><link rel="prefetch" href="/blog/assets/js/103.a7597fa2.js"><link rel="prefetch" href="/blog/assets/js/104.24531299.js"><link rel="prefetch" href="/blog/assets/js/105.10b2a4b3.js"><link rel="prefetch" href="/blog/assets/js/106.3ff91c4f.js"><link rel="prefetch" href="/blog/assets/js/107.ffabd889.js"><link rel="prefetch" href="/blog/assets/js/108.35f542ca.js"><link rel="prefetch" href="/blog/assets/js/109.bd8f74e0.js"><link rel="prefetch" href="/blog/assets/js/11.d36ef131.js"><link rel="prefetch" href="/blog/assets/js/110.182a6fc4.js"><link rel="prefetch" href="/blog/assets/js/111.947ac851.js"><link rel="prefetch" href="/blog/assets/js/112.08456d8c.js"><link rel="prefetch" href="/blog/assets/js/113.585e06ab.js"><link rel="prefetch" href="/blog/assets/js/114.86dcb468.js"><link rel="prefetch" href="/blog/assets/js/115.7b77e604.js"><link rel="prefetch" href="/blog/assets/js/116.79e3c86b.js"><link rel="prefetch" href="/blog/assets/js/117.caf49482.js"><link rel="prefetch" href="/blog/assets/js/118.0b77e591.js"><link rel="prefetch" href="/blog/assets/js/119.ce29e687.js"><link rel="prefetch" href="/blog/assets/js/12.c5493e01.js"><link rel="prefetch" href="/blog/assets/js/120.c90b1f67.js"><link rel="prefetch" href="/blog/assets/js/121.48f52b13.js"><link rel="prefetch" href="/blog/assets/js/122.2af9cf66.js"><link rel="prefetch" href="/blog/assets/js/13.430eca0c.js"><link rel="prefetch" href="/blog/assets/js/14.c88f86cd.js"><link rel="prefetch" href="/blog/assets/js/15.e1cc950a.js"><link rel="prefetch" href="/blog/assets/js/16.b699b95c.js"><link rel="prefetch" href="/blog/assets/js/17.b99ba729.js"><link rel="prefetch" href="/blog/assets/js/18.7dff4b06.js"><link rel="prefetch" href="/blog/assets/js/19.ff06d982.js"><link rel="prefetch" href="/blog/assets/js/20.7de9995c.js"><link rel="prefetch" href="/blog/assets/js/21.cb9bdcf0.js"><link rel="prefetch" href="/blog/assets/js/22.16dfd536.js"><link rel="prefetch" href="/blog/assets/js/23.eb560dbc.js"><link rel="prefetch" href="/blog/assets/js/24.661e2539.js"><link rel="prefetch" href="/blog/assets/js/25.c7f21645.js"><link rel="prefetch" href="/blog/assets/js/26.ed9b5095.js"><link rel="prefetch" href="/blog/assets/js/27.e74d660a.js"><link rel="prefetch" href="/blog/assets/js/28.f119234c.js"><link rel="prefetch" href="/blog/assets/js/29.4ebed3b0.js"><link rel="prefetch" href="/blog/assets/js/3.00356991.js"><link rel="prefetch" href="/blog/assets/js/30.64faf300.js"><link rel="prefetch" href="/blog/assets/js/31.34e09941.js"><link rel="prefetch" href="/blog/assets/js/32.e50cc8ec.js"><link rel="prefetch" href="/blog/assets/js/33.9461dbb1.js"><link rel="prefetch" href="/blog/assets/js/34.e4da7325.js"><link rel="prefetch" href="/blog/assets/js/35.2045a65d.js"><link rel="prefetch" href="/blog/assets/js/36.3a5bd736.js"><link rel="prefetch" href="/blog/assets/js/37.7f16fe49.js"><link rel="prefetch" href="/blog/assets/js/38.b943265e.js"><link rel="prefetch" href="/blog/assets/js/39.998540b3.js"><link rel="prefetch" href="/blog/assets/js/4.7fa5c39e.js"><link rel="prefetch" href="/blog/assets/js/40.6aff5b27.js"><link rel="prefetch" href="/blog/assets/js/41.260aa7d0.js"><link rel="prefetch" href="/blog/assets/js/42.feaf6bdd.js"><link rel="prefetch" href="/blog/assets/js/43.53183817.js"><link rel="prefetch" href="/blog/assets/js/44.6dab230d.js"><link rel="prefetch" href="/blog/assets/js/45.b6fd5fa7.js"><link rel="prefetch" href="/blog/assets/js/46.4d50f591.js"><link rel="prefetch" href="/blog/assets/js/47.a769691a.js"><link rel="prefetch" href="/blog/assets/js/48.8a2599f2.js"><link rel="prefetch" href="/blog/assets/js/49.1c846391.js"><link rel="prefetch" href="/blog/assets/js/5.8a935be6.js"><link rel="prefetch" href="/blog/assets/js/50.a61291b3.js"><link rel="prefetch" href="/blog/assets/js/51.7dceb146.js"><link rel="prefetch" href="/blog/assets/js/52.441d5a51.js"><link rel="prefetch" href="/blog/assets/js/53.046b88a2.js"><link rel="prefetch" href="/blog/assets/js/54.b5596254.js"><link rel="prefetch" href="/blog/assets/js/55.f9077d07.js"><link rel="prefetch" href="/blog/assets/js/56.7cd32adc.js"><link rel="prefetch" href="/blog/assets/js/57.07a79e6c.js"><link rel="prefetch" href="/blog/assets/js/58.3c2714d1.js"><link rel="prefetch" href="/blog/assets/js/59.2942e8a9.js"><link rel="prefetch" href="/blog/assets/js/6.c6745fa4.js"><link rel="prefetch" href="/blog/assets/js/60.2034c67b.js"><link rel="prefetch" href="/blog/assets/js/61.af320179.js"><link rel="prefetch" href="/blog/assets/js/62.fec720d6.js"><link rel="prefetch" href="/blog/assets/js/63.34fd5f71.js"><link rel="prefetch" href="/blog/assets/js/64.08909954.js"><link rel="prefetch" href="/blog/assets/js/65.c5c5f29e.js"><link rel="prefetch" href="/blog/assets/js/66.1f2fccf4.js"><link rel="prefetch" href="/blog/assets/js/67.4fe4556f.js"><link rel="prefetch" href="/blog/assets/js/68.b4beef25.js"><link rel="prefetch" href="/blog/assets/js/69.c6a9d2c9.js"><link rel="prefetch" href="/blog/assets/js/7.f127ebf8.js"><link rel="prefetch" href="/blog/assets/js/70.00b93126.js"><link rel="prefetch" href="/blog/assets/js/71.133e5d42.js"><link rel="prefetch" href="/blog/assets/js/72.99877bb3.js"><link rel="prefetch" href="/blog/assets/js/73.957556a6.js"><link rel="prefetch" href="/blog/assets/js/74.e4a072d4.js"><link rel="prefetch" href="/blog/assets/js/75.0cd14136.js"><link rel="prefetch" href="/blog/assets/js/76.bd566a9e.js"><link rel="prefetch" href="/blog/assets/js/77.c6f42303.js"><link rel="prefetch" href="/blog/assets/js/78.e9ebefa1.js"><link rel="prefetch" href="/blog/assets/js/79.72d36919.js"><link rel="prefetch" href="/blog/assets/js/80.a61bc76f.js"><link rel="prefetch" href="/blog/assets/js/81.a082ccbf.js"><link rel="prefetch" href="/blog/assets/js/82.ef0d1455.js"><link rel="prefetch" href="/blog/assets/js/83.59d4128f.js"><link rel="prefetch" href="/blog/assets/js/84.5b2501ff.js"><link rel="prefetch" href="/blog/assets/js/85.cfb6864a.js"><link rel="prefetch" href="/blog/assets/js/86.5487c200.js"><link rel="prefetch" href="/blog/assets/js/87.27164930.js"><link rel="prefetch" href="/blog/assets/js/88.1f0b6531.js"><link rel="prefetch" href="/blog/assets/js/89.0fe143c2.js"><link rel="prefetch" href="/blog/assets/js/90.e658e2b0.js"><link rel="prefetch" href="/blog/assets/js/91.f53450dd.js"><link rel="prefetch" href="/blog/assets/js/92.c604ad6a.js"><link rel="prefetch" href="/blog/assets/js/93.bfae73e5.js"><link rel="prefetch" href="/blog/assets/js/94.87427a06.js"><link rel="prefetch" href="/blog/assets/js/95.2a709d19.js"><link rel="prefetch" href="/blog/assets/js/96.2d7b8fe3.js"><link rel="prefetch" href="/blog/assets/js/97.e9923d97.js"><link rel="prefetch" href="/blog/assets/js/98.fd7ee458.js"><link rel="prefetch" href="/blog/assets/js/99.6a29e68b.js"><link rel="prefetch" href="/blog/assets/js/vendors~docsearch.162bdabc.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.495eacbe.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/img/logo.png" alt="åˆ˜æ–°å†¬çš„åšå®¢" class="logo"> <span class="site-name can-hide">åˆ˜æ–°å†¬çš„åšå®¢</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  é¦–é¡µ
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  é¦–é¡µ
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Jvm</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/java/jvm/" aria-current="page" class="sidebar-link">ç®€ä»‹</a></li><li><a href="/blog/java/jvm/default/HotSpotVMæ¶æ„.html" class="sidebar-link">HotSpotVM æ¶æ„</a></li><li><a href="/blog/java/jvm/default/JVMæ€§èƒ½ç›‘æ§.html" class="sidebar-link">JVMæ€§èƒ½ç›‘æ§</a></li><li><a href="/blog/java/jvm/default/JVMæ€§èƒ½è°ƒä¼˜.html" class="sidebar-link">JVMæ€§èƒ½è°ƒä¼˜</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>[TOC]</p> <h1 id="_1-jps"><a href="#_1-jps" class="header-anchor">#</a> 1 jps</h1> <p>JVM Process Status Toolï¼Œæ˜¾ç¤ºç³»ç»Ÿå†…æ‰€æœ‰çš„HotSpotè™šæ‹Ÿæœºè¿›ç¨‹ã€‚</p> <h2 id="_1-1-å‘½ä»¤æ ¼å¼"><a href="#_1-1-å‘½ä»¤æ ¼å¼" class="header-anchor">#</a> 1.1 å‘½ä»¤æ ¼å¼</h2> <p><code>jps [option] [hostid]</code></p> <p><strong>option</strong>å‚æ•°</p> <ul><li><code>-l</code>ï¼šè¾“å‡ºä¸»ç±»å…¨åæˆ–jarè·¯å¾„ ã€‚</li> <li><code>-q</code>ï¼šåªè¾“å‡ºLVMID ã€‚</li> <li><code>-m</code>ï¼šè¾“å‡ºJVMå¯åŠ¨æ—¶ä¼ é€’ç»™main()çš„å‚æ•° ã€‚</li> <li><code>-v</code>ï¼šè¾“å‡ºJVMå¯åŠ¨æ—¶æ˜¾å¼æŒ‡å®šçš„JVMå‚æ•°ã€‚</li></ul> <p>å…¶ä¸­[option]ã€[hostid]å‚æ•°ä¹Ÿå¯ä»¥ä¸å†™ã€‚</p> <h2 id="_1-2-ç¤ºä¾‹"><a href="#_1-2-ç¤ºä¾‹" class="header-anchor">#</a> 1.2 ç¤ºä¾‹</h2> <div class="language- extra-class"><pre class="language-text"><code>$ jps -l -m 
22786 org.apache.zookeeper.server.quorum.QuorumPeerMain /opt/zk/bin/../conf/zoo.cfg 
1718 com.aliyun.tianji.cloudmonitor.Application 
18664 /home/bookishBlogApp/vertx-bookish-1.0-fat.jar 
22971 sun.tools.jps.Jps -l -m
</code></pre></div><h1 id="_2-jstat"><a href="#_2-jstat" class="header-anchor">#</a> 2 Jstat</h1> <p>jstat(JVM statistics Monitoring)æ˜¯ç”¨äºç›‘è§†è™šæ‹Ÿæœºè¿è¡Œæ—¶çŠ¶æ€ä¿¡æ¯çš„å‘½ä»¤ï¼Œå®ƒå¯ä»¥æ˜¾ç¤ºå‡ºè™šæ‹Ÿæœºè¿›ç¨‹ä¸­çš„ç±»è£…è½½ã€å†…å­˜ã€åƒåœ¾æ”¶é›†ã€JITç¼–è¯‘ç­‰è¿è¡Œæ•°æ®ã€‚</p> <h2 id="_2-1-å‘½ä»¤æ ¼å¼"><a href="#_2-1-å‘½ä»¤æ ¼å¼" class="header-anchor">#</a> 2.1 å‘½ä»¤æ ¼å¼</h2> <div class="language- extra-class"><pre class="language-text"><code>jstat [option] LVMID [interval] [count]
</code></pre></div><p><strong>å‚æ•°</strong></p> <ul><li><code>[option]</code>ï¼šæ“ä½œå‚æ•°ã€‚</li> <li><code>LVMID</code>ï¼šæœ¬åœ°è™šæ‹Ÿæœºè¿›ç¨‹IDã€‚</li> <li><code>[interval]</code>ï¼šè¿ç»­è¾“å‡ºçš„æ—¶é—´é—´éš”ã€‚</li> <li><code>[count]</code>ï¼šè¿ç»­è¾“å‡ºçš„æ¬¡æ•°ã€‚</li></ul> <p><strong>option å‚æ•°æ€»è§ˆ</strong></p> <table><thead><tr><th style="text-align:center;">å‚æ•°å€¼</th> <th style="text-align:center;">è¯´æ˜</th></tr></thead> <tbody><tr><td style="text-align:center;">class</td> <td style="text-align:center;">ç±»åŠ è½½çš„è¡Œä¸ºç»Ÿè®¡</td></tr> <tr><td style="text-align:center;">compiler</td> <td style="text-align:center;">JITç¼–è¯‘å™¨çš„è¡Œä¸ºç»Ÿè®¡</td></tr> <tr><td style="text-align:center;">gc</td> <td style="text-align:center;">åƒåœ¾å›æ”¶ä¸­å †çš„è¡Œä¸ºç»Ÿè®¡</td></tr> <tr><td style="text-align:center;">gccapacity</td> <td style="text-align:center;">å„ä¸ªåƒåœ¾å›æ”¶ä»£ï¼ˆæ–°ç”Ÿä»£ã€è€å¹´ä»£ã€æ°¸ä¹…ä»£/å…ƒæ•°æ®åŒºï¼‰å’Œå®ƒä»¬ç›¸åº”çš„ç©ºé—´ç»Ÿè®¡</td></tr> <tr><td style="text-align:center;">gcutil</td> <td style="text-align:center;">åƒåœ¾å›æ”¶ç»Ÿè®¡æ¦‚è¿°</td></tr> <tr><td style="text-align:center;">gccause</td> <td style="text-align:center;">åƒåœ¾æ”¶é›†ç»Ÿè®¡æ¦‚è¿°ï¼ˆåŒ-gcutilï¼‰ï¼Œé™„åŠ æœ€è¿‘ä¸¤æ¬¡åƒåœ¾å›æ”¶äº‹ä»¶çš„åŸå› </td></tr> <tr><td style="text-align:center;">gcnew</td> <td style="text-align:center;">æ–°ç”Ÿä»£è¡Œä¸ºç»Ÿè®¡</td></tr> <tr><td style="text-align:center;">gcnewcapacity</td> <td style="text-align:center;">æ–°ç”Ÿä»£ä¸å…¶ç›¸åº”çš„å†…å­˜ç©ºé—´çš„ç»Ÿè®¡</td></tr> <tr><td style="text-align:center;">gcold</td> <td style="text-align:center;">è€å¹´ä»£å’Œæ°¸ä¹…ä»£è¡Œä¸ºç»Ÿè®¡</td></tr> <tr><td style="text-align:center;">gcoldcapacity</td> <td style="text-align:center;">è€å¹´ä»£ä¸å…¶ç›¸åº”çš„å†…å­˜ç©ºé—´çš„ç»Ÿè®¡</td></tr> <tr><td style="text-align:center;">gcpermcapacity</td> <td style="text-align:center;">æ°¸ä¹…ä»£ä¸å…¶ç›¸åº”çš„å†…å­˜ç©ºé—´çš„ç»Ÿè®¡</td></tr> <tr><td style="text-align:center;">gcmetacapacity</td> <td style="text-align:center;">å…ƒæ•°æ®åŒºä¸å…¶ç›¸åº”çš„å†…å­˜ç©ºé—´çš„ç»Ÿè®¡</td></tr> <tr><td style="text-align:center;">printcompilation</td> <td style="text-align:center;">HotSpotç¼–è¯‘æ–¹æ³•ç»Ÿè®¡</td></tr></tbody></table> <h2 id="_2-2-ç¤ºä¾‹"><a href="#_2-2-ç¤ºä¾‹" class="header-anchor">#</a> 2.2 ç¤ºä¾‹</h2> <h3 id="_2-2-1-class"><a href="#_2-2-1-class" class="header-anchor">#</a> 2.2.1 -class</h3> <p>ç›‘è§†ç±»è£…è½½ã€å¸è½½æ•°é‡ã€æ€»ç©ºé—´ä»¥åŠè€—è´¹çš„æ—¶é—´ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>$ jstat -class 18664 
Loaded Bytes  Unloaded Bytes Time 
5065   9756.9 0        0.0   2.96
</code></pre></div><ul><li><code>Loaded</code> : åŠ è½½classçš„æ•°é‡</li> <li><code>Bytes</code> :åŠ è½½ classå­—èŠ‚å¤§å°</li> <li><code>Unloaded</code> : æœªåŠ è½½classçš„æ•°é‡</li> <li><code>Bytes</code> : æœªåŠ è½½classçš„å­—èŠ‚å¤§å°</li> <li><code>Time</code> : åŠ è½½æ—¶é—´</li></ul> <h3 id="_2-2-2-compiler"><a href="#_2-2-2-compiler" class="header-anchor">#</a> 2.2.2 -compiler</h3> <p>è¾“å‡ºJITç¼–è¯‘è¿‡çš„æ–¹æ³•ã€æ•°é‡ã€è€—æ—¶ç­‰ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>$jstat -compiler 18664 
Compiled Failed Invalid Time FailedType FailedMethod 
5914     0      0       9.56 0
</code></pre></div><ul><li><code>Compiled</code> : ç¼–è¯‘æ•°é‡</li> <li><code>Failed</code> : ç¼–è¯‘å¤±è´¥æ•°é‡</li> <li><code>Invalid</code> : æ— æ•ˆæ•°é‡</li> <li><code>Time</code> : ç¼–è¯‘è€—æ—¶</li> <li><code>FailedType</code> : å¤±è´¥ç±»å‹</li> <li><code>FailedMethod</code> : å¤±è´¥æ–¹æ³•çš„å…¨é™å®šå</li></ul> <h3 id="_2-2-3-gc"><a href="#_2-2-3-gc" class="header-anchor">#</a> 2.2.3 -gc</h3> <p>åƒåœ¾å›æ”¶å †çš„è¡Œä¸ºç»Ÿè®¡ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>$ jstat -gc 18664 
S0C   S1C   S0U   S1U EC     EU     OC      OU      MC      MU      CCSC   CCSU   YGC YGCT  FGC FGCT GCT 
704.0 704.0 173.4 0.0 5824.0 4523.7 14332.0 13111.4 32128.0 31190.5 3712.0 3524.6 200 0.451 6 0.151 0.601
</code></pre></div><p>Cå³Capacity æ€»å®¹é‡ï¼ŒUå³Used å·²ä½¿ç”¨çš„å®¹é‡</p> <ul><li><code>S0C</code> : survivor0åŒºçš„æ€»å®¹é‡</li> <li><code>S1C</code> : survivor1åŒºçš„æ€»å®¹é‡</li> <li><code>S0U</code> : survivor0åŒºå·²ä½¿ç”¨çš„å®¹é‡</li> <li><code>S1C</code> : survivor1åŒºå·²ä½¿ç”¨çš„å®¹é‡</li> <li><code>EC</code> : EdenåŒºçš„æ€»å®¹é‡</li> <li><code>EU</code> : EdenåŒºå·²ä½¿ç”¨çš„å®¹é‡</li> <li><code>OC</code> : OldåŒºçš„æ€»å®¹é‡</li> <li><code>OU</code> : OldåŒºå·²ä½¿ç”¨çš„å®¹é‡</li> <li><code>PC</code> å½“å‰æ°¸ä¹…ä»£çš„å®¹é‡ (KB)</li> <li><code>PU</code> æ°¸ä¹…ä»£å·²ä½¿ç”¨çš„å®¹é‡ (KB)</li> <li><code>MC</code> å½“å‰å…ƒæ•°æ®åŒºçš„å®¹é‡ (KB)</li> <li><code>MU</code> å…ƒæ•°æ®åŒºå·²ä½¿ç”¨çš„å®¹é‡ (KB)</li> <li><code>YGC</code> : æ–°ç”Ÿä»£åƒåœ¾å›æ”¶æ¬¡æ•°</li> <li><code>YGCT</code> : æ–°ç”Ÿä»£åƒåœ¾å›æ”¶æ—¶é—´</li> <li><code>FGC</code> : è€å¹´ä»£åƒåœ¾å›æ”¶æ¬¡æ•°</li> <li><code>FGCT</code> : è€å¹´ä»£åƒåœ¾å›æ”¶æ—¶é—´</li> <li><code>GCT</code> : åƒåœ¾å›æ”¶æ€»æ¶ˆè€—æ—¶é—´</li></ul> <h3 id="_2-2-4-gccapacity"><a href="#_2-2-4-gccapacity" class="header-anchor">#</a> 2.2.4 -gccapacity</h3> <p>åŒ-gcï¼Œä¸è¿‡è¿˜ä¼šè¾“å‡ºJavaå †å„åŒºåŸŸä½¿ç”¨åˆ°çš„æœ€å¤§ã€æœ€å°ç©ºé—´ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>$ jstat -gccapacity 18664 
NGCMN   NGCMX    NGC    S0C   S1C   EC     OGCMN   OGCMX    OGC     OC      MCMN MCMX      MC      CCSMN CCSMX     CCSC   YGC FGC 
5440.0  85312.0  7232.0 704.0 704.0 5824.0 10944.0 170688.0 14332.0 14332.0 0.0  1077248.0 32128.0 0.0   1048576.0 3712.0 200 6
</code></pre></div><ul><li><code>NGCMN</code>: æ–°ç”Ÿä»£å ç”¨çš„æœ€å°ç©ºé—´</li> <li><code>NGCMX</code> : æ–°ç”Ÿä»£å ç”¨çš„æœ€å¤§ç©ºé—´</li> <li><code>NGC</code> : å½“å‰æ–°ç”Ÿä»£çš„å®¹é‡</li> <li><code>OGCMN</code> : è€å¹´ä»£å ç”¨çš„æœ€å°ç©ºé—´</li> <li><code>OGCMX</code> : è€å¹´ä»£å ç”¨çš„æœ€å¤§ç©ºé—´</li> <li><code>OGC</code>ï¼šå½“å‰å¹´è€ä»£çš„å®¹é‡ (KB)</li> <li><code>OC</code>ï¼šå½“å‰å¹´è€ä»£çš„ç©ºé—´ (KB)</li> <li><code>PGCMN</code> : æ°¸ä¹…ä»£å ç”¨çš„æœ€å°ç©ºé—´</li> <li><code>PGCMX</code> : æ°¸ä¹…ä»£å ç”¨çš„æœ€å¤§ç©ºé—´</li> <li><code>MCMN</code> : å…ƒæ•°æ®åŒºå ç”¨çš„æœ€å°ç©ºé—´</li> <li><code>MCMX</code> : å…ƒæ•°æ®åŒºå ç”¨çš„æœ€å¤§ç©ºé—´</li></ul> <h3 id="_2-2-5-gcutil"><a href="#_2-2-5-gcutil" class="header-anchor">#</a> 2.2.5 -gcutil</h3> <p>åŒ-gcï¼Œä¸è¿‡è¾“å‡ºçš„æ˜¯å·²ä½¿ç”¨ç©ºé—´å æ€»ç©ºé—´çš„ç™¾åˆ†æ¯”ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>$ jstat -gcutil 18664 
S0     S1    E      O      M      CCS    YGC  YGCT   FGC  FGCT   GCT 
24.63  0.00  85.44  91.48  97.08  94.95  200  0.451  6    0.151  0.601
</code></pre></div><h3 id="_2-2-6-gccause"><a href="#_2-2-6-gccause" class="header-anchor">#</a> 2.2.6 -gccause</h3> <p>åƒåœ¾æ”¶é›†ç»Ÿè®¡æ¦‚è¿°ï¼ˆåŒ-gcutilï¼‰ï¼Œé™„åŠ æœ€è¿‘ä¸¤æ¬¡åƒåœ¾å›æ”¶äº‹ä»¶çš„åŸå› ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>$ jstat -gccause 18664 
S0     S1    E      O      M      CCS    YGC  YGCT   FGC  FGCT   GCT    LGCC                GCC 
24.63  0.00  86.71  91.48  97.08  94.95  200  0.451  6    0.151  0.601  Allocation Failure  No GC
</code></pre></div><ul><li><code>LGCC</code>ï¼šæœ€è¿‘åƒåœ¾å›æ”¶çš„åŸå› </li> <li><code>GCC</code>ï¼šå½“å‰åƒåœ¾å›æ”¶çš„åŸå› </li></ul> <h3 id="_2-2-7-gcnew"><a href="#_2-2-7-gcnew" class="header-anchor">#</a> 2.2.7 -gcnew</h3> <p>ç»Ÿè®¡æ–°ç”Ÿä»£çš„è¡Œä¸ºã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>$ jstat -gcnew 18664 
S0C    S1C    S0U    S1U  TT  MTT  DSS    EC      EU      YGC  YGCT 
704.0  704.0  173.4  0.0  15  15   352.0  5824.0  5225.8  200  0.451
</code></pre></div><ul><li><code>TT</code>ï¼šTenuring threshold(æå‡é˜ˆå€¼)</li> <li><code>MTT</code>ï¼šæœ€å¤§çš„tenuring threshold</li> <li><code>DSS</code>ï¼šsurvivoråŒºåŸŸå¤§å° (KB)</li></ul> <h3 id="_2-2-8-gcnewcapacity"><a href="#_2-2-8-gcnewcapacity" class="header-anchor">#</a> 2.2.8 -gcnewcapacity</h3> <p>æ–°ç”Ÿä»£ä¸å…¶ç›¸åº”çš„å†…å­˜ç©ºé—´çš„ç»Ÿè®¡ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>$ jstat -gcnewcapacity 18664 
NGCMN   NGCMX    NGC     S0CMX   S0C    S1CMX   S1C    ECMX     EC      YGC  FGC 
5440.0  85312.0  7232.0  8512.0  704.0  8512.0  704.0  68288.0  5824.0  200  6
</code></pre></div><ul><li><code>NGC</code>:å½“å‰å¹´è½»ä»£çš„å®¹é‡ (KB)</li> <li><code>S0CMX</code>:æœ€å¤§çš„S0ç©ºé—´ (KB)</li> <li><code>S0C</code>:å½“å‰S0ç©ºé—´ (KB)</li> <li><code>ECMX</code>:æœ€å¤§edenç©ºé—´ (KB)</li> <li><code>EC</code>:å½“å‰edenç©ºé—´ (KB)</li></ul> <h3 id="_2-2-9-gcold"><a href="#_2-2-9-gcold" class="header-anchor">#</a> 2.2.9 -gcold</h3> <p>ç»Ÿè®¡è€å¹´ä»£çš„è¡Œä¸ºã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>$ jstat -gcold 18664 
MC      MU      CCSC   CCSU   OC      OU      YGC  FGC  FGCT   GCT 
32128.0 31190.5 3712.0 3524.6 14332.0 13111.4 200  6    0.151  0.601
</code></pre></div><h3 id="_2-2-10-gcoldcapacity"><a href="#_2-2-10-gcoldcapacity" class="header-anchor">#</a> 2.2.10 -gcoldcapacity</h3> <p>ç»Ÿè®¡è€å¹´ä»£çš„å¤§å°å’Œç©ºé—´ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>$ jstat -gcoldcapacity 18664 
OGCMN   OGCMX    OGC     OC      YGC FGC FGCT  GCT 
10944.0 170688.0 14332.0 14332.0 200 6   0.151 0.601
</code></pre></div><h3 id="_2-2-11-gcpermcapacity"><a href="#_2-2-11-gcpermcapacity" class="header-anchor">#</a> 2.2.11 -gcpermcapacity</h3> <p>æ°¸ä¹…ä»£è¡Œä¸ºç»Ÿè®¡ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>$ jstat -gcpermcapacity 28920 
 PGCMN      PGCMX       PGC         PC            YGC   FGC    FGCT     GCT   
 1048576.0  2097152.0   1048576.0   1048576.0     4     0      0.000    0.242
</code></pre></div><h3 id="_2-2-12-gcmetacapacity"><a href="#_2-2-12-gcmetacapacity" class="header-anchor">#</a> 2.2.12 -gcmetacapacity</h3> <p>å…ƒæ•°æ®åŒºè¡Œä¸ºç»Ÿè®¡ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>$ jstat -gcmetacapacity 18664 
MCMN MCMX      MC      CCSMN CCSMX     CCSC   YGC FGC FGCT   GCT 
0.0  1077248.0 32128.0 0.0   1048576.0 3712.0 200 6   0.151  0.601
</code></pre></div><h3 id="_2-2-13-printcompilation"><a href="#_2-2-13-printcompilation" class="header-anchor">#</a> 2.2.13 -printcompilation</h3> <p>hotspotç¼–è¯‘æ–¹æ³•ç»Ÿè®¡ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>$ jstat -printcompilation 18664 
Compiled Size Type Method 
5914     16   1    com/mongodb/connection/RequestMessage$EncodingMetadata &lt;init&gt;
</code></pre></div><ul><li><code>Compiled</code>ï¼šè¢«æ‰§è¡Œçš„ç¼–è¯‘ä»»åŠ¡çš„æ•°é‡</li> <li><code>Size</code>ï¼šæ–¹æ³•å­—èŠ‚ç çš„å­—èŠ‚æ•°</li> <li><code>Type</code>ï¼šç¼–è¯‘ç±»å‹</li> <li><code>Method</code>ï¼šç¼–è¯‘æ–¹æ³•çš„ç±»åå’Œæ–¹æ³•åã€‚ç±»åä½¿ç”¨â€/â€ ä»£æ›¿ â€œ.â€ ä½œä¸ºç©ºé—´åˆ†éš”ç¬¦ã€‚æ–¹æ³•åæ˜¯ç»™å‡ºç±»çš„æ–¹æ³•åï¼Œæ ¼å¼æ˜¯ä¸€è‡´äºHotSpot â€“ XX:+PrintComplation é€‰é¡¹ã€‚</li></ul> <h1 id="_3-jmap"><a href="#_3-jmap" class="header-anchor">#</a> 3 jmap</h1> <p>jmap(JVM Memory Map)å‘½ä»¤ç”¨äºç”Ÿæˆheap dumpæ–‡ä»¶ï¼Œå¦‚æœä¸ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ï¼Œè¿˜å¯ä»¥ä½¿ç”¨<code>-XX:+HeapDumpOnOutOfMemoryError</code>å‚æ•°æ¥è®©è™šæ‹Ÿæœºå‡ºç°OOMçš„æ—¶å€™è‡ªåŠ¨ç”Ÿæˆdumpæ–‡ä»¶ã€‚ jmapä¸ä»…èƒ½ç”Ÿæˆdumpæ–‡ä»¶ï¼Œè¿˜å¯ä»¥æŸ¥è¯¢finalizeæ‰§è¡Œé˜Ÿåˆ—ã€Javaå †å’Œæ°¸ä¹…ä»£çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚å½“å‰ä½¿ç”¨ç‡ã€å½“å‰ä½¿ç”¨çš„æ˜¯å“ªç§æ”¶é›†å™¨ç­‰ã€‚</p> <h2 id="_3-1-å‘½ä»¤æ ¼å¼"><a href="#_3-1-å‘½ä»¤æ ¼å¼" class="header-anchor">#</a> 3.1 å‘½ä»¤æ ¼å¼</h2> <div class="language- extra-class"><pre class="language-text"><code>jmap [option] LVMID
</code></pre></div><p><strong>optionå‚æ•°</strong></p> <ul><li><code>dump</code> : ç”Ÿæˆå †è½¬å‚¨å¿«ç…§</li> <li><code>finalizerinfo</code> : æ˜¾ç¤ºåœ¨F-Queueé˜Ÿåˆ—ç­‰å¾…Finalizerçº¿ç¨‹æ‰§è¡Œfinalizeræ–¹æ³•çš„å¯¹è±¡</li> <li><code>heap</code> : æ˜¾ç¤ºJavaå †è¯¦ç»†ä¿¡æ¯</li> <li><code>histo</code> : æ˜¾ç¤ºå †ä¸­å¯¹è±¡çš„ç»Ÿè®¡ä¿¡æ¯</li> <li><code>permstat</code> : to print permanent generation statistics</li> <li><code>F</code> : å½“-dumpæ²¡æœ‰å“åº”æ—¶ï¼Œå¼ºåˆ¶ç”Ÿæˆdumpå¿«ç…§</li></ul> <h2 id="_3-2-ç¤ºä¾‹"><a href="#_3-2-ç¤ºä¾‹" class="header-anchor">#</a> 3.2 ç¤ºä¾‹</h2> <h3 id="_3-2-1-dump"><a href="#_3-2-1-dump" class="header-anchor">#</a> 3.2.1 -dump</h3> <p>å¸¸ç”¨æ ¼å¼<code>-dump::live,format=b,file= pid</code>
dumpå †åˆ°æ–‡ä»¶ï¼ŒformatæŒ‡å®šè¾“å‡ºæ ¼å¼ï¼ŒliveæŒ‡æ˜æ˜¯æ´»ç€çš„å¯¹è±¡ï¼ŒfileæŒ‡å®šæ–‡ä»¶å</p> <div class="language- extra-class"><pre class="language-text"><code>$ jmap -dump:live,format=b,file=dump.hprof 28920 
Dumping heap to /home/xxx/dump.hprof ... 
Heap dump file created 
dump.hprofè¿™ä¸ªåç¼€æ˜¯ä¸ºäº†åç»­å¯ä»¥ç›´æ¥ç”¨MAT(Memory Anlysis Tool)æ‰“å¼€
</code></pre></div><p>ğŸ’¡ å¯ä»¥ä½¿ç”¨ <strong><a href="http://www.eclipse.org/mat/downloads.php" target="_blank">Eclipse Memory Analyzer</a></strong> å·¥å…·åˆ†æå †è½¬å‚¨æ–‡ä»¶ï¼Œéå¸¸éå¸¸éå¸¸å¥½ç”¨ï¼</p> <h3 id="_3-2-2-finalizerinfo"><a href="#_3-2-2-finalizerinfo" class="header-anchor">#</a> 3.2.2 -finalizerinfo</h3> <p>æ‰“å°ç­‰å¾…å›æ”¶å¯¹è±¡çš„ä¿¡æ¯ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>$ jmap -finalizerinfo 18664 
Attaching to process ID 18664, please wait... 
Debugger attached successfully. 
Server compiler detected. 
JVM version is 25.144-b01 
Number of objects pending for finalization: 0
</code></pre></div><p>å¯ä»¥çœ‹åˆ°å½“å‰F-QUEUEé˜Ÿåˆ—ä¸­å¹¶æ²¡æœ‰ç­‰å¾…Finalizerçº¿ç¨‹æ‰§è¡Œfinalizeræ–¹æ³•çš„å¯¹è±¡</p> <h3 id="_3-2-3-heap"><a href="#_3-2-3-heap" class="header-anchor">#</a> 3.2.3 -heap</h3> <p>æ‰“å°heapçš„æ¦‚è¦ä¿¡æ¯ã€GCä½¿ç”¨çš„ç®—æ³•ã€heapçš„é…ç½®åŠwise heapçš„ä½¿ç”¨æƒ…å†µã€‚å¯ä»¥ç”¨æ­¤æ¥åˆ¤æ–­å†…å­˜ç›®å‰çš„ä½¿ç”¨æƒ…å†µä»¥åŠåƒåœ¾å›æ”¶æƒ…å†µã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>$ jmap -heap 18664 
Attaching to process ID 18664, please wait... 
Debugger attached successfully. 
Server compiler detected. 
JVM version is 25.144-b01 

using thread-local object allocation. 
Mark Sweep Compact GC	                //æ ‡è®°å‹ç¼©GCç®—æ³• 

Heap Configuration: 
MinHeapFreeRatio = 40	                //å¯¹åº”jvmå¯åŠ¨å‚æ•°-XX:MinHeapFreeRatioè®¾ç½®JVMå †æœ€å°ç©ºé—²æ¯”ç‡(default 40) 
MaxHeapFreeRatio = 70	                //å¯¹åº”jvmå¯åŠ¨å‚æ•° -XX:MaxHeapFreeRatioè®¾ç½®JVMå †æœ€å¤§ç©ºé—²æ¯”ç‡(default 70) 
MaxHeapSize = 262144000 (250.0MB)	//å¯¹åº”jvmå¯åŠ¨å‚æ•°-XX:MaxHeapSize=è®¾ç½®JVMå †çš„æœ€å¤§å¤§å° 
NewSize = 5570560 (5.3125MB)	        //å¯¹åº”jvmå¯åŠ¨å‚æ•°-XX:NewSize=è®¾ç½®JVMå †çš„â€˜æ–°ç”Ÿä»£â€™çš„é»˜è®¤å¤§å° 
MaxNewSize = 87359488 (83.3125MB)	//å¯¹åº”jvmå¯åŠ¨å‚æ•°-XX:MaxNewSize=è®¾ç½®JVMå †çš„â€˜æ–°ç”Ÿä»£â€™çš„æœ€å¤§å¤§å° 
OldSize = 11206656 (10.6875MB)	        //å¯¹åº”jvmå¯åŠ¨å‚æ•°-XX:OldSize=&lt;value&gt;:è®¾ç½®JVMå †çš„â€˜è€å¹´ä»£â€™çš„å¤§å° 
NewRatio = 2	                        //å¯¹åº”jvmå¯åŠ¨å‚æ•°-XX:NewRatio=:â€˜æ–°ç”Ÿä»£â€™å’Œâ€˜è€å¹´ä»£â€™çš„å¤§å°æ¯”ç‡ 
SurvivorRatio = 8	                //å¯¹åº”jvmå¯åŠ¨å‚æ•°-XX:SurvivorRatio=è®¾ç½®å¹´è½»ä»£ä¸­EdenåŒºä¸SurvivoråŒºçš„å¤§å°æ¯”å€¼ 
MetaspaceSize = 21807104 (20.796875MB)	//å¯¹åº”jvmå¯åŠ¨å‚æ•°-XX:MetaspaceSize=&lt;value&gt;:è®¾ç½®JVMå †çš„â€˜å…ƒæ•°æ®åŒºâ€™çš„åˆå§‹å¤§å° 
CompressedClassSpaceSize = 1073741824 (1024.0MB)	
MaxMetaspaceSize = 17592186044415 MB	//å¯¹åº”jvmå¯åŠ¨å‚æ•°-XX:MetaspaceSize=&lt;value&gt;:è®¾ç½®JVMå †çš„â€˜å…ƒæ•°æ®åŒºâ€™çš„æœ€å¤§å¤§å° 
G1HeapRegionSize = 0 (0.0MB)	        //G1åƒåœ¾æ”¶é›†å™¨æ¯ä¸ªRegionåŒºçš„å¤§å° 

Heap Usage: 
New Generation (Eden + 1 Survivor Space): 
capacity = 6815744 (6.5MB) 
used = 279696 (0.2667388916015625MB) 
free = 6536048 (6.2332611083984375MB) 
4.103675255408654% used 
Eden Space: 
capacity = 6094848 (5.8125MB) 
used = 279696 (0.2667388916015625MB) 
free = 5815152 (5.5457611083984375MB) 
4.589056199596774% used 
From Space: 
capacity = 720896 (0.6875MB) 
used = 0 (0.0MB) 
free = 720896 (0.6875MB) 
0.0% used 
To Space: 
capacity = 720896 (0.6875MB) 
used = 0 (0.0MB) 
free = 720896 (0.6875MB) 
0.0% used 
tenured generation: 
capacity = 14675968 (13.99609375MB) 
used = 6804304 (6.4890899658203125MB) 
free = 7871664 (7.5070037841796875MB) 
46.36357887943065% used 

8522 interned Strings occupying 779072 bytes.
</code></pre></div><p>å¯ä»¥å¾ˆæ¸…æ¥šçš„çœ‹åˆ°Javaå †ä¸­å„ä¸ªåŒºåŸŸç›®å‰çš„æƒ…å†µã€‚</p> <h3 id="_3-2-4-histo"><a href="#_3-2-4-histo" class="header-anchor">#</a> 3.2.4 -histo</h3> <p>æ‰“å°å †çš„å¯¹è±¡ç»Ÿè®¡ï¼ŒåŒ…æ‹¬å¯¹è±¡æ•°ã€å†…å­˜å¤§å°ç­‰ç­‰ ï¼ˆå› ä¸ºåœ¨dump:liveå‰ä¼šè¿›è¡Œfull gcï¼Œå¦‚æœå¸¦ä¸Šliveåˆ™åªç»Ÿè®¡æ´»å¯¹è±¡ï¼Œå› æ­¤ä¸åŠ liveçš„å †å¤§å°è¦å¤§äºåŠ liveå †çš„å¤§å° ï¼‰</p> <div class="language- extra-class"><pre class="language-text"><code>$ jmap -histo:live 18664 | more 

num #instances #bytes class name 
---------------------------------------------- 
1: 19123 1458752 [C 
2: 1639 746888 [B 
3: 5430 604224 java.lang.Class 
4: 19017 456408 java.lang.String 
5: 4056 385696 [Ljava.lang.Object; 
6: 8636 276352 java.util.concurrent.ConcurrentHashMap$Node 
7: 2749 145248 [I 
8: 3436 137440 java.util.LinkedHashMap$Entry 
9: 1256 110528 java.lang.reflect.Method 
10: 29 106976 [Ljava.nio.ByteBuffer; 
11: 3274 104768 java.util.HashMap$Node 
12: 6471 103536 java.lang.Object 
13: 814 90656 [Ljava.util.HashMap$Node; 
14: 81 89984 [Ljava.util.concurrent.ConcurrentHashMap$Node; 
15: 78 51168 io.netty.util.internal.shaded.org.jctools.queues.Mps
</code></pre></div><p>class nameæ˜¯å¯¹è±¡ç±»å‹ï¼Œè¯´æ˜å¦‚ä¸‹ï¼š</p> <ul><li><code>B</code> ï¼šbyte</li> <li><code>C</code> ï¼šchar</li> <li><code>D</code> ï¼šdouble</li> <li><code>F</code> ï¼šfloat</li> <li><code>I</code> ï¼šint</li> <li><code>J</code> ï¼šlong</li> <li><code>Z</code> ï¼šboolean</li> <li><code>[</code> ï¼šæ•°ç»„ï¼Œå¦‚[Iè¡¨ç¤ºint[]</li> <li><code>[L+ç±»å</code> ï¼šå…¶ä»–å¯¹è±¡</li></ul> <h3 id="_3-2-5-permstat"><a href="#_3-2-5-permstat" class="header-anchor">#</a> 3.2.5 -permstat</h3> <p>æ‰“å°Javaå †å†…å­˜çš„æ°¸ä¹…ä¿å­˜åŒºåŸŸçš„ç±»åŠ è½½å™¨çš„æ™ºèƒ½ç»Ÿè®¡ä¿¡æ¯ã€‚</p> <p>å¯¹äºæ¯ä¸ªç±»åŠ è½½å™¨è€Œè¨€ï¼Œå®ƒçš„åç§°ã€æ´»è·ƒåº¦ã€åœ°å€ã€çˆ¶ç±»åŠ è½½å™¨ã€å®ƒæ‰€åŠ è½½çš„ç±»çš„æ•°é‡å’Œå¤§å°éƒ½ä¼šè¢«æ‰“å°ã€‚æ­¤å¤–ï¼ŒåŒ…å«çš„å­—ç¬¦ä¸²æ•°é‡å’Œå¤§å°ä¹Ÿä¼šè¢«æ‰“å°ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>$ jmap -permstat 28920 
  Attaching to process ID 28920, please wait... 
  Debugger attached successfully. 
  Server compiler detected. 
  JVM version is 24.71-b01 
  finding class loader instances ..done. 
  computing per loader stat ..done. 
  please wait.. computing liveness.liveness analysis may be inaccurate ... 
  
  class_loader            classes bytes   parent_loader           alive?  type  
  &lt;bootstrap&gt;             3111    18154296          null          live    &lt;internal&gt; 
  0x0000000600905cf8      1       1888    0x0000000600087f08      dead    sun/reflect/DelegatingClassLoader@0x00000007800500a0 
  0x00000006008fcb48      1       1888    0x0000000600087f08      dead    sun/reflect/DelegatingClassLoader@0x00000007800500a0 
  0x00000006016db798      0       0       0x00000006008d3fc0      dead    java/util/ResourceBundle$RBClassLoader@0x0000000780626ec0 
  0x00000006008d6810      1       3056      null          dead    sun/reflect/DelegatingClassLoader@0x00000007800500a0
</code></pre></div><h3 id="_3-2-6-f"><a href="#_3-2-6-f" class="header-anchor">#</a> 3.2.6 -F</h3> <p>å¼ºåˆ¶æ¨¡å¼ã€‚</p> <p>å¦‚æœæŒ‡å®šçš„pidæ²¡æœ‰å“åº”ï¼Œè¯·ä½¿ç”¨jmap -dumpæˆ–jmap -histoé€‰é¡¹ã€‚æ­¤æ¨¡å¼ä¸‹ï¼Œä¸æ”¯æŒliveå­é€‰é¡¹ã€‚</p> <h1 id="_4-jhat"><a href="#_4-jhat" class="header-anchor">#</a> 4 jhat</h1> <p>jhat(JVM Heap Analysis Tool)å‘½ä»¤æ˜¯ä¸jmapæ­é…ä½¿ç”¨ï¼Œç”¨æ¥åˆ†æjmapç”Ÿæˆçš„dumpï¼Œjhatå†…ç½®äº†ä¸€ä¸ªå¾®å‹çš„HTTP/HTMLæœåŠ¡å™¨ï¼Œç”Ÿæˆdumpçš„åˆ†æç»“æœåï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ã€‚</p> <p>åœ¨æ­¤è¦æ³¨æ„ï¼Œä¸€èˆ¬ä¸ä¼šç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šè¿›è¡Œåˆ†æï¼Œå› ä¸ºjhatæ˜¯ä¸€ä¸ªè€—æ—¶å¹¶ä¸”è€—è´¹ç¡¬ä»¶èµ„æºçš„è¿‡ç¨‹ï¼Œä¸€èˆ¬æŠŠæœåŠ¡å™¨ç”Ÿæˆçš„dumpæ–‡ä»¶å¤åˆ¶åˆ°æœ¬åœ°æˆ–å…¶ä»–æœºå™¨ä¸Šè¿›è¡Œåˆ†æã€‚</p> <h2 id="_4-1-å‘½ä»¤æ ¼å¼"><a href="#_4-1-å‘½ä»¤æ ¼å¼" class="header-anchor">#</a> 4.1 å‘½ä»¤æ ¼å¼</h2> <div class="language- extra-class"><pre class="language-text"><code>jhat [dumpfile]
</code></pre></div><p><strong>å‚æ•°</strong></p> <ul><li><code>-stack</code> ï¼šfalse|true ï¼Œå…³é—­å¯¹è±¡åˆ†é…è°ƒç”¨æ ˆè·Ÿè¸ª(tracking object allocation call stack)ã€‚ å¦‚æœåˆ†é…ä½ç½®ä¿¡æ¯åœ¨å †è½¬å‚¨ä¸­ä¸å¯ç”¨ï¼Œåˆ™å¿…é¡»å°†æ­¤æ ‡å¿—è®¾ç½®ä¸º falseï¼Œé»˜è®¤å€¼ä¸º trueã€‚</li> <li><code>-refs</code>ï¼š false|true ï¼Œå…³é—­å¯¹è±¡å¼•ç”¨è·Ÿè¸ª(tracking of references to objects)ã€‚é»˜è®¤å€¼ä¸º trueï¼Œé»˜è®¤æƒ…å†µä¸‹, è¿”å›çš„æŒ‡é’ˆæ˜¯æŒ‡å‘å…¶ä»–ç‰¹å®šå¯¹è±¡çš„å¯¹è±¡ï¼Œå¦‚åå‘é“¾æ¥æˆ–è¾“å…¥å¼•ç”¨(referrers or incoming references)ï¼Œä¼šç»Ÿè®¡è®¡ç®—å †ä¸­çš„æ‰€æœ‰å¯¹è±¡ã€‚</li> <li><code>-port</code> ï¼šport-numberï¼Œè®¾ç½® jhat HTTP server çš„ç«¯å£å·ã€‚é»˜è®¤å€¼ 7000ã€‚</li> <li><code>-exclude</code> ï¼šexclude-fileï¼ŒæŒ‡å®šå¯¹è±¡æŸ¥è¯¢æ—¶éœ€è¦æ’é™¤çš„æ•°æ®æˆå‘˜åˆ—è¡¨æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ–‡ä»¶åˆ—åˆ—å‡ºjava.lang.String.value , é‚£ä¹ˆå½“ä»æŸä¸ªç‰¹å®šå¯¹è±¡ Object o è®¡ç®—å¯è¾¾çš„å¯¹è±¡åˆ—è¡¨æ—¶, å¼•ç”¨è·¯å¾„æ¶‰åŠ java.lang.String.value çš„éƒ½ä¼šè¢«æ’é™¤ã€‚</li> <li><code>-baseline</code> ï¼šexclude-fileï¼ŒæŒ‡å®šä¸€ä¸ªåŸºå‡†å †è½¬å‚¨(baseline heap dump)ã€‚åœ¨ä¸¤ä¸ª heap dumps ä¸­æœ‰ç›¸åŒ object ID çš„å¯¹è±¡ä¼šè¢«æ ‡è®°ä¸ºä¸æ˜¯æ–°çš„(marked as not being new)ï¼Œå…¶ä»–å¯¹è±¡è¢«æ ‡è®°ä¸ºæ–°çš„(new)ï¼Œåœ¨æ¯”è¾ƒä¸¤ä¸ªä¸åŒçš„å †è½¬å‚¨æ—¶å¾ˆæœ‰ç”¨ã€‚</li> <li><code>-debug</code> ï¼šintï¼Œè®¾ç½® debug çº§åˆ«. 0 è¡¨ç¤ºä¸è¾“å‡ºè°ƒè¯•ä¿¡æ¯ã€‚ å€¼è¶Šå¤§åˆ™è¡¨ç¤ºè¾“å‡ºæ›´è¯¦ç»†çš„ debug ä¿¡æ¯ã€‚</li> <li><code>-version</code> ï¼šå¯åŠ¨ååªæ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯å°±é€€å‡ºã€‚</li> <li><code>-J&lt; flag &gt;</code> ï¼šå› ä¸º jhat å‘½ä»¤å®é™…ä¸Šä¼šå¯åŠ¨ä¸€ä¸ªJVMæ¥æ‰§è¡Œï¼Œé€šè¿‡ -J å¯ä»¥åœ¨å¯åŠ¨JVMæ—¶ä¼ å…¥ä¸€äº›å¯åŠ¨å‚æ•°ã€‚
ä¾‹å¦‚ï¼š -J-Xmx512m åˆ™æŒ‡å®šè¿è¡Œ jhat çš„Javaè™šæ‹Ÿæœºä½¿ç”¨çš„æœ€å¤§å †å†…å­˜ä¸º 512 MBï¼Œå¦‚æœéœ€è¦ä½¿ç”¨å¤šä¸ªJVMå¯åŠ¨å‚æ•°ï¼Œåˆ™ä¼ å…¥å¤šä¸ª -Jxxxxxxã€‚</li></ul> <h2 id="_4-2-ç¤ºä¾‹"><a href="#_4-2-ç¤ºä¾‹" class="header-anchor">#</a> 4.2 ç¤ºä¾‹</h2> <div class="language- extra-class"><pre class="language-text"><code>$ jhat -J-Xmx512m dump.hprof 
Reading from dump.hprof... 
Dump file created Fri Feb 23 13:40:54 CST 2018 
Snapshot read, resolving... 
Resolving 110430 objects... 
Chasing references, expect 22 dots...................... 
Eliminating duplicate references...................... 
Snapshot resolved. 
Started HTTP server on port 7000 
Server is ready.
</code></pre></div><p>ä¸­é—´çš„<code>-J-Xmx512m</code>æ˜¯åœ¨dumpå¿«ç…§å¾ˆå¤§çš„æƒ…å†µä¸‹åˆ†é…512Må†…å­˜å»å¯åŠ¨HTTPæœåŠ¡å™¨ï¼Œè¿è¡Œå®Œä¹‹åå°±å¯åœ¨æµè§ˆå™¨æ‰“å¼€Http://localhost:7000è¿›è¡Œå¿«ç…§åˆ†æï¼Œå †å¿«ç…§åˆ†æä¸»è¦åœ¨æœ€åé¢çš„Heap Histogramé‡Œï¼Œé‡Œé¢æ ¹æ®classåˆ—å‡ºäº†dumpçš„æ—¶å€™æ‰€æœ‰å­˜æ´»å¯¹è±¡ã€‚</p> <p>æ‰“å¼€æµè§ˆå™¨Http://localhost:7000ï¼Œè¯¥é¡µé¢æä¾›äº†å‡ ä¸ªæŸ¥è¯¢åŠŸèƒ½å¯ä¾›ä½¿ç”¨ï¼š</p> <p><img src="/img/java/jvm/9.1.png" alt="img"></p> <p>ä¸€èˆ¬æŸ¥çœ‹å †å¼‚å¸¸æƒ…å†µä¸»è¦çœ‹è¿™ä¸ªä¸¤ä¸ªéƒ¨åˆ†ï¼š Show instance counts for all classes (excluding platform)ï¼Œå¹³å°å¤–çš„æ‰€æœ‰å¯¹è±¡ä¿¡æ¯ã€‚å¦‚ä¸‹å›¾ï¼š</p> <p><img src="/img/java/jvm/9.2.png" alt="img"></p> <p>Show heap histogram ä»¥æ ‘çŠ¶å›¾å½¢å¼å±•ç¤ºå †æƒ…å†µã€‚å¦‚ä¸‹å›¾ï¼š</p> <p><img src="/img/java/jvm/9.3.png" alt="img"></p> <p>å…·ä½“æ’æŸ¥æ—¶éœ€è¦ç»“åˆä»£ç ï¼Œè§‚å¯Ÿæ˜¯å¦å¤§é‡åº”è¯¥è¢«å›æ”¶çš„å¯¹è±¡åœ¨ä¸€ç›´è¢«å¼•ç”¨æˆ–è€…æ˜¯å¦æœ‰å ç”¨å†…å­˜ç‰¹åˆ«å¤§çš„å¯¹è±¡æ— æ³•è¢«å›æ”¶ã€‚
ä¸€èˆ¬æƒ…å†µï¼Œä¼šdownåˆ°å®¢æˆ·ç«¯ç”¨å·¥å…·æ¥åˆ†æã€‚</p> <h1 id="_5-jstack"><a href="#_5-jstack" class="header-anchor">#</a> 5 jstack</h1> <p>jstackç”¨äºç”Ÿæˆjavaè™šæ‹Ÿæœºå½“å‰æ—¶åˆ»çš„çº¿ç¨‹å¿«ç…§ã€‚</p> <p>çº¿ç¨‹å¿«ç…§æ˜¯å½“å‰javaè™šæ‹Ÿæœºå†…æ¯ä¸€æ¡çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•å †æ ˆçš„é›†åˆï¼Œç”Ÿæˆçº¿ç¨‹å¿«ç…§çš„ä¸»è¦ç›®çš„æ˜¯å®šä½çº¿ç¨‹å‡ºç°é•¿æ—¶é—´åœé¡¿çš„åŸå› ï¼Œå¦‚çº¿ç¨‹é—´æ­»é”ã€æ­»å¾ªç¯ã€è¯·æ±‚å¤–éƒ¨èµ„æºå¯¼è‡´çš„é•¿æ—¶é—´ç­‰å¾…ç­‰ã€‚</p> <p>çº¿ç¨‹å‡ºç°åœé¡¿çš„æ—¶å€™é€šè¿‡jstackæ¥æŸ¥çœ‹å„ä¸ªçº¿ç¨‹çš„è°ƒç”¨å †æ ˆï¼Œå°±å¯ä»¥çŸ¥é“æ²¡æœ‰å“åº”çš„çº¿ç¨‹åˆ°åº•åœ¨åå°åšä»€ä¹ˆäº‹æƒ…ï¼Œæˆ–è€…ç­‰å¾…ä»€ä¹ˆèµ„æºã€‚ å¦‚æœjavaç¨‹åºå´©æºƒç”Ÿæˆcoreæ–‡ä»¶ï¼Œjstackå·¥å…·å¯ä»¥ç”¨æ¥è·å¾—coreæ–‡ä»¶çš„java stackå’Œnative stackçš„ä¿¡æ¯ï¼Œä»è€Œå¯ä»¥è½»æ¾åœ°çŸ¥é“javaç¨‹åºæ˜¯å¦‚ä½•å´©æºƒå’Œåœ¨ç¨‹åºä½•å¤„å‘ç”Ÿé—®é¢˜ã€‚å¦å¤–ï¼Œjstackå·¥å…·è¿˜å¯ä»¥é™„å±åˆ°æ­£åœ¨è¿è¡Œçš„javaç¨‹åºä¸­ï¼Œçœ‹åˆ°å½“æ—¶è¿è¡Œçš„javaç¨‹åºçš„java stackå’Œnative stackçš„ä¿¡æ¯ï¼Œå¦‚æœç°åœ¨è¿è¡Œçš„javaç¨‹åºå‘ˆç°hungçš„çŠ¶æ€ï¼Œjstackæ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</p> <h2 id="_5-1-å‘½ä»¤æ ¼å¼"><a href="#_5-1-å‘½ä»¤æ ¼å¼" class="header-anchor">#</a> 5.1 å‘½ä»¤æ ¼å¼</h2> <div class="language- extra-class"><pre class="language-text"><code>jstack [option] LVMID
</code></pre></div><p><strong>optionå‚æ•°</strong></p> <ul><li><code>-F</code> : å½“æ­£å¸¸è¾“å‡ºè¯·æ±‚ä¸è¢«å“åº”æ—¶ï¼Œå¼ºåˆ¶è¾“å‡ºçº¿ç¨‹å †æ ˆ</li> <li><code>-l</code> : é™¤å †æ ˆå¤–ï¼Œæ˜¾ç¤ºå…³äºé”çš„é™„åŠ ä¿¡æ¯</li> <li><code>-m</code> : å¦‚æœè°ƒç”¨åˆ°æœ¬åœ°æ–¹æ³•çš„è¯ï¼Œå¯ä»¥æ˜¾ç¤ºC/C++çš„å †æ ˆ</li></ul> <h2 id="_5-2-ç¤ºä¾‹"><a href="#_5-2-ç¤ºä¾‹" class="header-anchor">#</a> 5.2 ç¤ºä¾‹</h2> <div class="language- extra-class"><pre class="language-text"><code>$ jstack -l 18664 
2018-02-23 14:20:45 
Full thread dump Java HotSpot(TM) 64-Bit Server VM (25.144-b01 mixed mode): 

&quot;Thread-55&quot; #212 daemon prio=5 os_prio=0 tid=0x00007f68e079f800 nid=0x5fab waiting on condition [0x00007f68d93da000] 
java.lang.Thread.State: TIMED_WAITING (parking) 
at sun.misc.Unsafe.park(Native Method) 
- parking to wait for &lt;0x00000000f5bbda88&gt; (a java.util.concurrent.SynchronousQueue$TransferStack) 
at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215) 
at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460) 
at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362) 
at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941) 
at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1073) 
at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134) 
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) 
at java.lang.Thread.run(Thread.java:748) 

Locked ownable synchronizers: 
- None 
......
</code></pre></div><p>å…³äºjstackè¾“å‡ºçš„åˆ†æï¼Œè·³è½¬è¿™é‡Œï¼šhttp://www.hollischuang.com/archives/110 ï¼Œå†™çš„éå¸¸æ£’ã€‚</p> <h1 id="_6-jinfo"><a href="#_6-jinfo" class="header-anchor">#</a> 6 jinfo</h1> <p>jinfo(JVM Configuration info)è¿™ä¸ªå‘½ä»¤ä½œç”¨æ˜¯å®æ—¶æŸ¥çœ‹å’Œè°ƒæ•´è™šæ‹Ÿæœºè¿è¡Œå‚æ•°ã€‚ ä¹‹å‰çš„jps -vå£ä»¤åªèƒ½æŸ¥çœ‹åˆ°æ˜¾ç¤ºæŒ‡å®šçš„å‚æ•°ï¼Œå¦‚æœæƒ³è¦æŸ¥çœ‹æœªè¢«æ˜¾ç¤ºæŒ‡å®šçš„å‚æ•°çš„å€¼å°±è¦ä½¿ç”¨jinfoå£ä»¤</p> <h2 id="_6-1-å‘½ä»¤æ ¼å¼"><a href="#_6-1-å‘½ä»¤æ ¼å¼" class="header-anchor">#</a> 6.1 å‘½ä»¤æ ¼å¼</h2> <div class="language- extra-class"><pre class="language-text"><code>jinfo [option] [args] LVMID
</code></pre></div><p><strong>optionå‚æ•°</strong></p> <ul><li><code>-flag</code> : è¾“å‡ºæŒ‡å®šargså‚æ•°çš„å€¼</li> <li><code>-flags</code> : ä¸éœ€è¦argså‚æ•°ï¼Œè¾“å‡ºæ‰€æœ‰JVMå‚æ•°çš„å€¼</li> <li><code>-sysprops</code> : è¾“å‡ºç³»ç»Ÿå±æ€§ï¼Œç­‰åŒäºSystem.getProperties()</li></ul> <h2 id="_6-2-ç¤ºä¾‹"><a href="#_6-2-ç¤ºä¾‹" class="header-anchor">#</a> 6.2 ç¤ºä¾‹</h2> <div class="language- extra-class"><pre class="language-text"><code>$ jinfo -flags 18664 
Attaching to process ID 18664, please wait... 
Debugger attached successfully. 
Server compiler detected. 
JVM version is 25.144-b01 
Non-default VM flags: -XX:CICompilerCount=2 -XX:InitialHeapSize=16777216 -XX:MaxHeapSize=262144000 -XX:MaxNewSize=87359488 -XX:MinHeapDeltaBytes=196608 -XX:NewSize=5570560 -XX:OldSize=11206656 -XX:+PrintGC -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+UseCompressedClassPointers -XX:+UseCompressedOops 
Command line: -XX:+PrintGCTimeStamps -XX:+PrintGCDetails -Xloggc:/home/bookishBlogApp/gc.log
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/blog/assets/js/app.ba74f136.js" defer></script><script src="/blog/assets/js/2.ba6b1436.js" defer></script><script src="/blog/assets/js/1.2d4ce02f.js" defer></script><script src="/blog/assets/js/102.cbf39534.js" defer></script>
  </body>
</html>
