(window.webpackJsonp=window.webpackJsonp||[]).push([[105],{391:function(t,n,s){"use strict";s.r(n);var e=s(7),a=Object(e.a)({},(function(){var t=this,n=t._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("p",[t._v("nginx可以通过stream模块实现对tcp/udp协议的反向代理和负载均衡，在1.9版本之后，该模块内置在安装包中，但默认是不启用的。")]),t._v(" "),n("h2",{attrs:{id:"启用stream模块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#启用stream模块"}},[t._v("#")]),t._v(" 启用stream模块")]),t._v(" "),n("p",[t._v("在配置tcp/udp代理前，可通过命令 "),n("code",[t._v("nginx -V")]),t._v(" 查看是否启用了stream模块，执行该命令后，控制台输出如下：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("nginx version: nginx/1.14.0 (Ubuntu)\nbuilt with OpenSSL 1.1.1  11 Sep 2018\nTLS SNI support enabled\nconfigure arguments: --prefix=/usr/share/nginx --conf-path=/etc/nginx/nginx.conf --with-http_ssl_module --with-http_stub_status_module\n")])])]),n("p",[t._v("查看 "),n("code",[t._v("configure arguments")]),t._v(" 中是否包含 "),n("code",[t._v("--with-stream")]),t._v("，如果包含，说明已经启用了stream模块，否则说明未启用。")]),t._v(" "),n("p",[t._v("要启用stream模块，需要重新编译nginx，并在编译时添加 "),n("code",[t._v("--with-stream")]),t._v(" 来启用stream模块，编译命令如下：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("./configire --with-stream [...其他编译配置]\nmake\nmake install\n")])])]),n("p",[t._v("编译完成后，可再次通过上面的 "),n("code",[t._v("nginx -V")]),t._v(" 命令检查是否成功启用了stream模块。")]),t._v(" "),n("h2",{attrs:{id:"配置nginx-conf"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置nginx-conf"}},[t._v("#")]),t._v(" 配置nginx.conf")]),t._v(" "),n("p",[t._v("对于tcp/udp代理，通过stream关键字进行配置，它和http关键字同级，如下为22端口和3306端口的反向代理示例：")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("# http\nhttp {\n    server {\n        ...\n    }\n}\n\n# tcp/udp\nstream {\n    upstream ssh {\n        server 198.1.1.100:22;\n    }\n    \n    upstream mysql {\n        server 198.1.1.100:3306;\n    }\n    \n    # proxy 22\n    server {\n        listen 10022;\n        proxy_pass ssh;\n    }\n    \n    # proxy 3306\n    server {\n        listen 13306;\n        proxy_pass mysql;\n    }\n}\n")])])]),n("p",[t._v("如果需要设置代理超时时间、连接超时时间或者负载均衡等，配置方式和http反向代理的配置方式是一样的。")])])}),[],!1,null,null,null);n.default=a.exports}}]);